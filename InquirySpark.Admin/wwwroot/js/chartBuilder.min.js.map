{"version":3,"file":"js/chartBuilder.min.js","mappings":"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","sources":["webpack://inquiryspark-admin/./src/js/chartBuilder.ts"],"sourcesContent":["// Chart Builder TypeScript Module\r\n// Manages state and interactions for the chart definition builder interface\r\n\r\nexport interface ChartDefinition {\r\n    chartDefinitionId: number;\r\n    datasetId: number;\r\n    name: string;\r\n    description?: string;\r\n    tags?: string;\r\n    filterPayload?: string;\r\n    visualPayload?: string;\r\n    calculationPayload?: string;\r\n    versionNumber: number;\r\n    autoApprovedFl: boolean;\r\n}\r\n\r\nexport interface ChartBuilderState {\r\n    currentDefinition: ChartDefinition | null;\r\n    isDirty: boolean;\r\n    validationErrors: string[];\r\n}\r\n\r\nexport class ChartBuilderManager {\r\n    private state: ChartBuilderState = {\r\n        currentDefinition: null,\r\n        isDirty: false,\r\n        validationErrors: []\r\n    };\r\n\r\n    private previewChart: any = null;\r\n\r\n    constructor(\r\n        private chartCanvas: HTMLCanvasElement,\r\n        private onStateChange?: (state: ChartBuilderState) => void\r\n    ) {\r\n        this.initializeEventListeners();\r\n    }\r\n\r\n    /**\r\n     * Initialize event listeners for form fields\r\n     */\r\n    private initializeEventListeners(): void {\r\n        // Monitor changes to form fields\r\n        const form = document.querySelector('form') as HTMLFormElement;\r\n        if (form) {\r\n            form.addEventListener('input', () => {\r\n                this.state.isDirty = true;\r\n                this.notifyStateChange();\r\n            });\r\n        }\r\n\r\n        // JSON payload validation on blur\r\n        this.attachJsonValidation('FilterPayload');\r\n        this.attachJsonValidation('VisualPayload');\r\n        this.attachJsonValidation('CalculationPayload');\r\n    }\r\n\r\n    /**\r\n     * Attach JSON validation to textarea fields\r\n     */\r\n    private attachJsonValidation(fieldName: string): void {\r\n        const field = document.getElementById(fieldName) as HTMLTextAreaElement;\r\n        if (field) {\r\n            field.addEventListener('blur', () => {\r\n                this.validateJsonField(field, fieldName);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validate JSON syntax in a field\r\n     */\r\n    private validateJsonField(field: HTMLTextAreaElement, fieldName: string): boolean {\r\n        const value = field.value.trim();\r\n        if (!value) return true; // Empty is valid\r\n\r\n        try {\r\n            JSON.parse(value);\r\n            this.clearFieldError(field);\r\n            return true;\r\n        } catch (e) {\r\n            this.setFieldError(field, `Invalid JSON in ${fieldName}: ${(e as Error).message}`);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set error message for a field\r\n     */\r\n    private setFieldError(field: HTMLElement, message: string): void {\r\n        field.classList.add('is-invalid');\r\n        \r\n        // Remove existing error span if present\r\n        const existingError = field.parentElement?.querySelector('.invalid-feedback');\r\n        if (existingError) {\r\n            existingError.remove();\r\n        }\r\n\r\n        // Add new error span\r\n        const errorSpan = document.createElement('div');\r\n        errorSpan.className = 'invalid-feedback d-block';\r\n        errorSpan.textContent = message;\r\n        field.parentElement?.appendChild(errorSpan);\r\n    }\r\n\r\n    /**\r\n     * Clear error message for a field\r\n     */\r\n    private clearFieldError(field: HTMLElement): void {\r\n        field.classList.remove('is-invalid');\r\n        const errorSpan = field.parentElement?.querySelector('.invalid-feedback');\r\n        if (errorSpan) {\r\n            errorSpan.remove();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load chart definition into the builder\r\n     */\r\n    public loadDefinition(definition: ChartDefinition): void {\r\n        this.state.currentDefinition = definition;\r\n        this.state.isDirty = false;\r\n        this.state.validationErrors = [];\r\n        this.notifyStateChange();\r\n        \r\n        // Update preview if visual payload exists\r\n        if (definition.visualPayload) {\r\n            this.updatePreview(definition.visualPayload);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update chart preview with new configuration\r\n     */\r\n    public updatePreview(visualPayload: string): void {\r\n        if (!this.chartCanvas) return;\r\n\r\n        try {\r\n            const config = JSON.parse(visualPayload);\r\n            \r\n            // Destroy existing chart if present\r\n            if (this.previewChart) {\r\n                this.previewChart.destroy();\r\n            }\r\n\r\n            // Create new chart\r\n            // @ts-ignore - Chart.js loaded globally\r\n            this.previewChart = new Chart(this.chartCanvas.getContext('2d'), config);\r\n            \r\n            this.clearFieldError(document.getElementById('VisualPayload') as HTMLElement);\r\n        } catch (e) {\r\n            console.error('Failed to render chart preview:', e);\r\n            this.setFieldError(\r\n                document.getElementById('VisualPayload') as HTMLElement, \r\n                `Preview failed: ${(e as Error).message}`\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validate all form fields before submission\r\n     */\r\n    public validateForm(): boolean {\r\n        this.state.validationErrors = [];\r\n\r\n        const filterPayloadField = document.getElementById('FilterPayload') as HTMLTextAreaElement;\r\n        const visualPayloadField = document.getElementById('VisualPayload') as HTMLTextAreaElement;\r\n        const calculationPayloadField = document.getElementById('CalculationPayload') as HTMLTextAreaElement;\r\n\r\n        let isValid = true;\r\n\r\n        if (filterPayloadField && !this.validateJsonField(filterPayloadField, 'FilterPayload')) {\r\n            isValid = false;\r\n        }\r\n\r\n        if (visualPayloadField && !this.validateJsonField(visualPayloadField, 'VisualPayload')) {\r\n            isValid = false;\r\n        }\r\n\r\n        if (calculationPayloadField && !this.validateJsonField(calculationPayloadField, 'CalculationPayload')) {\r\n            isValid = false;\r\n        }\r\n\r\n        this.notifyStateChange();\r\n        return isValid;\r\n    }\r\n\r\n    /**\r\n     * Notify state change callback\r\n     */\r\n    private notifyStateChange(): void {\r\n        if (this.onStateChange) {\r\n            this.onStateChange(this.state);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if form has unsaved changes\r\n     */\r\n    public hasUnsavedChanges(): boolean {\r\n        return this.state.isDirty;\r\n    }\r\n\r\n    /**\r\n     * Get current builder state\r\n     */\r\n    public getState(): ChartBuilderState {\r\n        return { ...this.state };\r\n    }\r\n}\r\n\r\n// Auto-initialize on page load if canvas is present\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const canvas = document.getElementById('previewCanvas') as HTMLCanvasElement;\r\n    if (canvas) {\r\n        const manager = new ChartBuilderManager(canvas, (state) => {\r\n            console.log('Chart builder state changed:', state);\r\n        });\r\n\r\n        // Attach to window for global access\r\n        (window as any).chartBuilderManager = manager;\r\n\r\n        // Add form submission validation\r\n        const form = document.querySelector('form') as HTMLFormElement;\r\n        if (form) {\r\n            form.addEventListener('submit', (e) => {\r\n                if (!manager.validateForm()) {\r\n                    e.preventDefault();\r\n                    alert('Please fix validation errors before submitting.');\r\n                }\r\n            });\r\n        }\r\n\r\n        // Warn about unsaved changes\r\n        window.addEventListener('beforeunload', (e) => {\r\n            if (manager.hasUnsavedChanges()) {\r\n                e.preventDefault();\r\n                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';\r\n            }\r\n        });\r\n    }\r\n});\r\n"],"names":["ChartBuilderManager","constructor","chartCanvas","onStateChange","state","currentDefinition","isDirty","validationErrors","previewChart","this","initializeEventListeners","form","document","querySelector","addEventListener","notifyStateChange","attachJsonValidation","fieldName","field","getElementById","validateJsonField","value","trim","JSON","parse","clearFieldError","e","setFieldError","message","classList","add","existingError","parentElement","remove","errorSpan","createElement","className","textContent","appendChild","loadDefinition","definition","visualPayload","updatePreview","config","destroy","Chart","getContext","console","error","validateForm","filterPayloadField","visualPayloadField","calculationPayloadField","isValid","hasUnsavedChanges","getState","canvas","manager","log","window","chartBuilderManager","preventDefault","alert","returnValue"],"ignoreList":[],"sourceRoot":""}