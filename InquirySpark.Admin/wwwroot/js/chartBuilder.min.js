(()=>{"use strict";class t{constructor(t,e){this.chartCanvas=t,this.onStateChange=e,this.state={currentDefinition:null,isDirty:!1,validationErrors:[]},this.previewChart=null,this.initializeEventListeners()}initializeEventListeners(){const t=document.querySelector("form");t&&t.addEventListener("input",()=>{this.state.isDirty=!0,this.notifyStateChange()}),this.attachJsonValidation("FilterPayload"),this.attachJsonValidation("VisualPayload"),this.attachJsonValidation("CalculationPayload")}attachJsonValidation(t){const e=document.getElementById(t);e&&e.addEventListener("blur",()=>{this.validateJsonField(e,t)})}validateJsonField(t,e){const a=t.value.trim();if(!a)return!0;try{return JSON.parse(a),this.clearFieldError(t),!0}catch(a){return this.setFieldError(t,`Invalid JSON in ${e}: ${a.message}`),!1}}setFieldError(t,e){t.classList.add("is-invalid");const a=t.parentElement?.querySelector(".invalid-feedback");a&&a.remove();const i=document.createElement("div");i.className="invalid-feedback d-block",i.textContent=e,t.parentElement?.appendChild(i)}clearFieldError(t){t.classList.remove("is-invalid");const e=t.parentElement?.querySelector(".invalid-feedback");e&&e.remove()}loadDefinition(t){this.state.currentDefinition=t,this.state.isDirty=!1,this.state.validationErrors=[],this.notifyStateChange(),t.visualPayload&&this.updatePreview(t.visualPayload)}updatePreview(t){if(this.chartCanvas)try{const e=JSON.parse(t);this.previewChart&&this.previewChart.destroy(),this.previewChart=new Chart(this.chartCanvas.getContext("2d"),e),this.clearFieldError(document.getElementById("VisualPayload"))}catch(t){console.error("Failed to render chart preview:",t),this.setFieldError(document.getElementById("VisualPayload"),`Preview failed: ${t.message}`)}}validateForm(){this.state.validationErrors=[];const t=document.getElementById("FilterPayload"),e=document.getElementById("VisualPayload"),a=document.getElementById("CalculationPayload");let i=!0;return t&&!this.validateJsonField(t,"FilterPayload")&&(i=!1),e&&!this.validateJsonField(e,"VisualPayload")&&(i=!1),a&&!this.validateJsonField(a,"CalculationPayload")&&(i=!1),this.notifyStateChange(),i}notifyStateChange(){this.onStateChange&&this.onStateChange(this.state)}hasUnsavedChanges(){return this.state.isDirty}getState(){return{...this.state}}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("previewCanvas");if(e){const a=new t(e,t=>{console.log("Chart builder state changed:",t)});window.chartBuilderManager=a;const i=document.querySelector("form");i&&i.addEventListener("submit",t=>{a.validateForm()||(t.preventDefault(),alert("Please fix validation errors before submitting."))}),window.addEventListener("beforeunload",t=>{a.hasUnsavedChanges()&&(t.preventDefault(),t.returnValue="You have unsaved changes. Are you sure you want to leave?")})}})})();
//# sourceMappingURL=chartBuilder.min.js.map